"""
利用pywfn为pi键级填充颜色
"""
import sys;sys.path.append('d:/code/pywfn')
import matplotlib.pyplot as plt
import numpy as np
from pywfn.base import Mol
from pywfn.reader import LogReader
from pywfn.tools import xmlShow,xmlEdit

config={
    'C6H6':[
        [ 1, 2, 0.6604, 323,318],
        [ 1, 6, 0.6604, 323,322],
        [ 2, 3, 0.6604, 322,321],
        [ 3, 4, 0.6604, 321,320],
        [ 4, 5, 0.6604, 320,319],
        [ 5, 6, 0.6604, 319,318],
    ],
    'ph2':[
        [ 1, 2, 0.7372 ,450,448],
        [ 1, 6, 0.5623 ,448,446],
        [ 2, 3, 0.5391 ,450,434],
        [ 3, 4, 0.5345 ,434,432],
        [ 3,10, 0.5391 ,434,436],
        [ 4, 5, 0.5391 ,432,444],
        [ 4,11, 0.5391 ,432,430],
        [ 5, 6, 0.7372 ,444,446],
        [10,15, 0.7372 ,436,426],
        [11,14, 0.7372 ,428,430],
        [14,15, 0.5623 ,426,428],
    ],
    'line6':[
        [ 1, 4, 0.9036 ,306,307],
        [ 4, 6, 0.3981 ,307,308],
        [ 6, 8, 0.8380 ,308,309],
        [ 8,10, 0.3981 ,309,310],
        [10,12, 0.9036 ,310,311],
    ],
    'rNH2':[
        [1, 2, 0.9142 ,651,649],
        [2, 3, 0.3702 ,647,649],
        [3, 4, 0.9142 ,647,645],
    ],
    'rNF2':[
        [1, 2, 0.8954 ,761,760],
        [2, 3, 0.2477 ,760,759],
        [3, 4, 0.8954 ,759,758],
    ],
    'CH4CH4':[
        [1, 2, 0.9926 ,370,371],
        [1, 4, 0.0000 ,370,373],
        [2, 3, 0.0000 ,371,372],
        [3, 4, 0.9926 ,373,372],
    ],
    'ph-ph':[
        [ 1, 2, 0.6247 , 4, 6],
        [ 1, 6, 0.6247 , 6, 8],
        [ 1, 7, 0.3087 , 6,20],
        [ 2, 3, 0.6701 , 4, 2],
        [ 3, 4, 0.6528 , 2,12],
        [ 4, 5, 0.6528 ,12,10],
        [ 5, 6, 0.6701 ,10, 8],
        [ 7, 8, 0.6247 ,20,22],
        [ 7,12, 0.6247 ,20,30],
        [ 8, 9, 0.6701 ,22,24],
        [ 9,10, 0.6528 ,24,26],
        [10,11, 0.6528 ,26,28],
        [11,12, 0.6701 ,28,30],
    ],
    'phR-phR':[
        [ 1, 2, 0.6142, 863,864],
        [ 1, 6, 0.6744, 864,865],
        [ 2, 3, 0.6005, 863,862],
        [ 2,21, 0.3464, 863,870],
        [ 3, 4, 0.6127, 862,867],
        [ 3,10, 0.2801, 862,859],
        [ 4, 5, 0.6805, 867,866],
        [ 5, 6, 0.6331, 865,866],
        [10,11, 0.2893, 859,860],
        [10,12, 0.8330, 858,859],
        [11,13, 0.3165, 860,861],
        [11,20, 0.8375, 860,868],
        [12,14, 0.3377, 857,858],
        [13,16, 0.8852, 861,856],
        [14,16, 0.3095, 856,857],
        [14,19, 0.8243, 857,859],
    ],
    'since':[
        [ 1,21, 0.5331, 975,977],
        [ 1,37, 0.4507, 975,973],
        [ 2,21, 0.5219, 979,977],
        [ 2,29, 0.4522, 979,981],
        [21,54, 0.4505, 977,988],
        [26,47, 0.6576, 999,1001],
        [26,49, 0.6235, 999,990],
        [27,30, 0.6526, 1003,1005],
        [27,42, 0.6667, 1005,1007],
        [29,37, 0.8120, 981,973],
        [30,47, 0.6619, 1001,1003],
        [42,49, 0.6236, 990,1007],
        [49,54, 0.2220, 988,990],
        [54,55, 0.7261, 988,992],
        [55,56, 0.0000, 992,994],
    ]
}

def gen_colorBar():
    plt.rc('font',family='Times New Roman',size=20)
    num=100
    Rs=np.linspace(1,0,num)
    Gs=np.linspace(1,0,num)
    Bs=np.linspace(1,1,num)

    img=np.zeros(shape=(num,5,3))
    for i in range(5):
        img[:,i,0]=Rs
        img[:,i,1]=Gs
        img[:,i,2]=Bs

    plt.xticks([],[])
    plt.yticks([0,20,40,60,80,99],'0.0,0.2,0.4,0.6,0.8,1.0'.split(','))
    plt.imshow(img,origin='lower')
    # plt.xlabel('$\pi$ Bond Order')
    plt.savefig('图像/colorbar.png',dpi=300,bbox_inches='tight')

def xml_show():
    # reader=LogReader(path)
    # mol=Mol(reader)
    tool=xmlShow.Tool('pi电子.cdxml')
    tool.draw()

def xml_draw():
    tool=xmlEdit.Tool('pi电子.cdxml')
    paras={}
    for key,val in config.items():
        for _,_,v,n1,n2 in val:
            print(key,n1,n2,v)
            paras[f'{n1}-{n2}']=value2color(v)
    tool.set_color(paras)
    tool.save('pi电子2.cdxml')
            

def value2color(val):
    k=val
    c0=np.array([1.,1.,1.])
    c1=np.array([0.,0.,1.])
    r,g,b=c0+k*(c1-c0)
    return [r,g,b]
    

if __name__=='__main__':
    # gen_colorBar()
    # xml_show()
    xml_draw()